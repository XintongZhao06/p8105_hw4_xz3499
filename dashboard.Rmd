---
title: "NOAA Weather Dashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: scroll
    fig_width: 10
    fig_height: 6
---

```{r, echo=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r setup, include=FALSE}
library(tidyverse)
library(lubridate)
library(plotly)
library(flexdashboard)
library(p8105.datasets)

data("ny_noaa")

noaa_processed <- ny_noaa %>%
  mutate(
    date = as.Date(date),
    year = year(date),
    month = month(date, label = TRUE),
    prcp_mm = as.numeric(prcp) / 10,
    tmax = as.numeric(tmax)/10,
    tmin = as.numeric(tmin)/10,
    avg_temp = (tmax + tmin) / 2
  ) %>% 
  filter(year >= 2000 & year <= 2010) %>%
  filter(!is.na(tmax) & !is.na(tmin) & !is.na(prcp_mm) & !is.na(snwd)) %>%
  filter(prcp_mm >= 0 & prcp_mm <= 500,
         snow >= 0 & snow <= 1000)


monthly_summary <- noaa_processed %>%
  group_by(month) %>%
  summarise(
    mean_tmax = mean(tmax, na.rm = TRUE),
    mean_tmin = mean(tmin, na.rm = TRUE),
    total_prcp = sum(prcp_mm, na.rm = TRUE),
    .groups = 'drop'
  )

yearly_summary <- noaa_processed %>%
  group_by(year) %>%
  summarise(
    mean_tmax = mean(tmax, na.rm = TRUE),
    mean_tmin = mean(tmin, na.rm = TRUE),
    total_prcp = sum(prcp_mm, na.rm = TRUE),
    .groups = 'drop'
  )

snow_data <- noaa_processed %>%
  filter(!is.na(avg_temp) & snwd > 0) 
```

### üå°Ô∏è Monthly Temperature Trends

```{r}
plot_ly(monthly_summary) %>%
  add_trace(x = ~month, y = ~mean_tmax, type = 'scatter', mode = 'lines+markers',
            name = 'Max Temperature', 
            line = list(color = '#1E3A8A', width = 4), 
            marker = list(color = '#1E3A8A', size = 10, symbol = 'circle')) %>%
  add_trace(x = ~month, y = ~mean_tmin, type = 'scatter', mode = 'lines+markers',
            name = 'Min Temperature', 
            line = list(color = '#60A5FA', width = 4), 
            marker = list(color = '#60A5FA', size = 10, symbol = 'circle')) %>%
  layout(
    title = list(text = "Average Monthly Temperature (2000-2010)", 
                 font = list(size = 18, color = '#1E3A8A', family = 'Arial')),
    xaxis = list(title = "Month", 
                 gridcolor = 'rgba(96, 165, 250, 0.3)',
                 linecolor = '#1E3A8A',
                 tickfont = list(color = '#1E3A8A')),
    yaxis = list(title = "Temperature (¬∞C)", 
                 gridcolor = 'rgba(96, 165, 250, 0.3)',
                 linecolor = '#1E3A8A',
                 tickfont = list(color = '#1E3A8A')),
    plot_bgcolor = 'rgba(248, 250, 252, 0.8)',
    paper_bgcolor = 'rgba(248, 250, 252, 1)',
    font = list(color = '#1E3A8A', family = 'Arial'),
    showlegend = TRUE,
    legend = list(orientation = 'h', y = -0.2)
  )
```

### üåßÔ∏è Precipitation Distribution

```{r}
plot_ly(noaa_processed,
        x = ~prcp_mm,
        type = 'histogram',
        nbinsx = 40,
        marker = list(
          color = '#3B82F6',
          line = list(color = '#1D4ED8', width = 1.5)
        ),
        hoverinfo = 'x+y') %>%
  layout(
    title = list(text = "Daily Precipitation Distribution", 
                 font = list(size = 18, color = '#1E3A8A', family = 'Arial')),
    xaxis = list(title = "Precipitation (mm)", 
                 gridcolor = 'rgba(96, 165, 250, 0.3)',
                 linecolor = '#1E3A8A',
                 tickfont = list(color = '#1E3A8A')),
    yaxis = list(title = "Frequency", 
                 gridcolor = 'rgba(96, 165, 250, 0.3)',
                 linecolor = '#1E3A8A',
                 tickfont = list(color = '#1E3A8A')),
    plot_bgcolor = 'rgba(248, 250, 252, 0.8)',
    paper_bgcolor = 'rgba(248, 250, 252, 1)',
    font = list(color = '#1E3A8A', family = 'Arial')
  )
```

### üìä Annual Temperature Ranges

```{r}
plot_ly(yearly_summary, x = ~year, y = ~mean_tmax, type = 'bar',
        name = 'Average Max Temp', 
        marker = list(color = '#1E3A8A',
                      line = list(color = '#1E40AF', width = 1))) %>%
  add_trace(y = ~mean_tmin, name = 'Average Min Temp',
            marker = list(color = '#60A5FA',
                          line = list(color = '#3B82F6', width = 1))) %>%
  layout(
    title = list(text = "Annual Temperature Averages", 
                 font = list(size = 18, color = '#1E3A8A', family = 'Arial')),
    xaxis = list(title = "Year", 
                 gridcolor = 'rgba(96, 165, 250, 0.3)',
                 linecolor = '#1E3A8A',
                 tickfont = list(color = '#1E3A8A')),
    yaxis = list(title = "Temperature (¬∞C)", 
                 gridcolor = 'rgba(96, 165, 250, 0.3)',
                 linecolor = '#1E3A8A',
                 tickfont = list(color = '#1E3A8A')),
    barmode = 'group',
    plot_bgcolor = 'rgba(248, 250, 252, 0.8)',
    paper_bgcolor = 'rgba(248, 250, 252, 1)',
    font = list(color = '#1E3A8A', family = 'Arial')
  )
```

---

### ‚ùÑÔ∏è Snow Depth vs Temperature

```{r}
plot_ly(snow_data,
        x = ~avg_temp,
        y = ~snwd,
        type = 'scatter',
        mode = 'markers',
        marker = list(
          size = 12,
          opacity = 0.7,
          color = ~snwd,
          colorscale = 'Blues',
          showscale = TRUE,
          line = list(color = '#1E3A8A', width = 1),
          colorbar = list(title = list(text = "Snow Depth (mm)", 
                                      font = list(color = '#1E3A8A')),
                         tickfont = list(color = '#1E3A8A'))
        ),
        text = ~paste("Month:", month,
                     "<br>Avg Temp:", round(avg_temp, 1), "¬∞C", 
                     "<br>Snow Depth:", snwd, "mm",
                     "<br>Year:", year),
        hoverinfo = 'text') %>%
  layout(
    title = list(text = "Snow Depth vs Average Temperature", 
                 font = list(size = 18, color = '#1E3A8A', family = 'Arial')),
    xaxis = list(title = "Average Temperature (¬∞C)", 
                 gridcolor = 'rgba(96, 165, 250, 0.3)',
                 linecolor = '#1E3A8A',
                 tickfont = list(color = '#1E3A8A')),
    yaxis = list(title = "Snow Depth (mm)", 
                 gridcolor = 'rgba(96, 165, 250, 0.3)',
                 linecolor = '#1E3A8A',
                 tickfont = list(color = '#1E3A8A')),
    plot_bgcolor = 'rgba(248, 250, 252, 0.8)',
    paper_bgcolor = 'rgba(248, 250, 252, 1)',
    font = list(color = '#1E3A8A', family = 'Arial')
  )
```

### üìà Monthly Precipitation

```{r}
plot_ly(monthly_summary, x = ~month, y = ~total_prcp, type = 'bar',
        marker = list(color = ~total_prcp,
                      colorscale = list(c(0, '#DBEAFE'), c(1, '#1E40AF')),
                      line = list(color = '#1E40AF', width = 1.5)),
        hoverinfo = 'x+y') %>%
  layout(
    title = list(text = "Total Monthly Precipitation", 
                 font = list(size = 18, color = '#1E3A8A', family = 'Arial')),
    xaxis = list(title = "Month", 
                 gridcolor = 'rgba(96, 165, 250, 0.3)',
                 linecolor = '#1E3A8A',
                 tickfont = list(color = '#1E3A8A')),
    yaxis = list(title = "Precipitation (mm)", 
                 gridcolor = 'rgba(96, 165, 250, 0.3)',
                 linecolor = '#1E3A8A',
                 tickfont = list(color = '#1E3A8A')),
    plot_bgcolor = 'rgba(248, 250, 252, 0.8)',
    paper_bgcolor = 'rgba(248, 250, 252, 1)',
    font = list(color = '#1E3A8A', family = 'Arial')
  )
```

### üå°Ô∏è Temperature Distribution

```{r}
plot_ly(noaa_processed, y = ~tmax, type = "box", 
        name = 'Max Temp', 
        boxpoints = "outliers",
        marker = list(color = '#1E3A8A'),
        line = list(color = '#1E3A8A'),
        fillcolor = 'rgba(30, 58, 138, 0.3)') %>%
  add_trace(y = ~tmin, name = 'Min Temp',
            marker = list(color = '#60A5FA'),
            line = list(color = '#60A5FA'),
            fillcolor = 'rgba(96, 165, 250, 0.3)') %>%
  layout(
    title = list(text = "Temperature Distribution", 
                 font = list(size = 18, color = '#1E3A8A', family = 'Arial')),
    xaxis = list(title = "", 
                 tickfont = list(color = '#1E3A8A')),
    yaxis = list(title = "Temperature (¬∞C)", 
                 gridcolor = 'rgba(96, 165, 250, 0.3)',
                 linecolor = '#1E3A8A',
                 tickfont = list(color = '#1E3A8A')),
    plot_bgcolor = 'rgba(248, 250, 252, 0.8)',
    paper_bgcolor = 'rgba(248, 250, 252, 1)',
    font = list(color = '#1E3A8A', family = 'Arial')
  )
```
